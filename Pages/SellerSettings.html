<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, minimum-scale=1, maximum-scale=1, user-scalable=no, viewport-fit=cover">
    <title>Kajwelo - Seller Settings</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }

        :root {
            --primary-color: #667eea;
            --secondary-color: #764ba2;
            --accent-color: #f093fb;
            --success-color: #10b981;
            --warning-color: #f59e0b;
            --danger-color: #ef4444;
            --dark-color: #1f2937;
            --light-color: #f8fafc;
            --sidebar-width: 280px;
            --topbar-height: 70px;
        }

        body { font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif; background-color: #f8f9fa; line-height: 1.6; }

        .sidebar { position: fixed; top: 0; left: -100%; height: 100vh; width: var(--sidebar-width); background: linear-gradient(135deg, var(--primary-color) 0%, var(--secondary-color) 100%); z-index: 1000; transition: left 0.3s ease-in-out; overflow-y: auto; overflow-x: hidden; }
        .sidebar.open { left: 0; }
        .sidebar-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background-color: rgba(0, 0, 0, 0.5); z-index: 999; opacity: 0; visibility: hidden; transition: all 0.3s ease-in-out; }
        .sidebar-overlay.active { opacity: 1; visibility: visible; }
        .sidebar-header { padding: 1.5rem; border-bottom: 1px solid rgba(255,255,255,0.1); }
        .sidebar-logo { font-size: 1.5rem; font-weight: bold; color: white; margin-bottom: 0.25rem; }
        .sidebar-subtitle { color: rgba(255,255,255,0.8); font-size: 0.875rem; }
        .sidebar-menu { list-style: none; padding: 1rem 0; }
        .sidebar-link { display: flex; align-items: center; padding: 0.875rem 1.5rem; color: rgba(255,255,255,0.8); text-decoration: none; transition: all 0.2s ease; border: none; background: none; width: 100%; cursor: pointer; }
        .sidebar-link:hover, .sidebar-link.active { background-color: rgba(255,255,255,0.1); color: white; transform: translateX(5px); }
        .sidebar-link i { width: 20px; margin-right: 0.75rem; text-align: center; }

        .main-content { transition: margin-left 0.3s ease-in-out; min-height: 100vh; }
        .topbar { background: white; box-shadow: 0 2px 10px rgba(0,0,0,0.05); padding: 1rem 1.5rem; display: flex; justify-content: space-between; align-items: center; height: var(--topbar-height); position: sticky; top: 0; z-index: 100; }
        .menu-toggle { background: none; border: none; font-size: 1.25rem; color: var(--dark-color); margin-right: 1rem; cursor: pointer; padding: 0.5rem; }
        .page-title { font-size: 1.5rem; font-weight: 600; color: var(--dark-color); margin: 0; }
        .user-profile { display: flex; align-items: center; gap: 0.5rem; }
        .user-avatar { width: 40px; height: 40px; border-radius: 50%; background: linear-gradient(135deg, var(--primary-color), var(--accent-color)); display: flex; align-items: center; justify-content: center; color: white; font-weight: bold; text-transform: uppercase; }

        .settings-container { padding: 1.5rem; max-width: 1200px; margin: 0 auto; }
        .card-like { background: white; border-radius: 16px; padding: 1.5rem; box-shadow: 0 4px 6px rgba(0,0,0,0.05); margin-bottom: 1rem; }
        .section-title { font-size: 1.125rem; font-weight: 600; color: var(--dark-color); margin-bottom: 1rem; display: flex; align-items: center; gap: 0.5rem; }
        .form-label { font-weight: 600; color: var(--dark-color); font-size: 0.875rem; }
        .form-control, .form-select { border: 2px solid #e5e7eb; border-radius: 10px; padding: 0.75rem; font-size: 0.9rem; }
        .form-control:focus, .form-select:focus { outline: none; border-color: var(--primary-color); box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1); }

        .btn-primary { background: linear-gradient(135deg, var(--primary-color), var(--secondary-color)); color: white; border: none; border-radius: 10px; padding: 0.75rem 1.25rem; font-weight: 600; }
        .btn-primary:hover { transform: translateY(-1px); box-shadow: 0 8px 25px rgba(102, 126, 234, 0.3); }
        .btn-danger { background: linear-gradient(135deg, var(--danger-color), #dc2626); color: white; border: none; border-radius: 10px; padding: 0.75rem 1.25rem; font-weight: 600; }
        .btn-outline { background: white; color: var(--primary-color); border: 2px solid var(--primary-color); border-radius: 10px; padding: 0.75rem 1.25rem; font-weight: 600; }
        .btn-outline:hover { background: var(--primary-color); color: white; }

        .divider { height: 1px; background: #e5e7eb; margin: 1rem 0; }
        .danger-box { border: 1px dashed rgba(239, 68, 68, 0.35); background: #fff; border-radius: 12px; padding: 1rem; }

        .notification { position: fixed; top: 20px; right: 20px; padding: 0.75rem 1rem; border-radius: 10px; color: white; z-index: 3000; display: none; }
        .notification.show { display: block; }
        .notification.success { background: var(--success-color); }
        .notification.error { background: var(--danger-color); }
        .notification.info { background: var(--primary-color); }

        @media (min-width: 993px) {
            .sidebar { left: 0; position: fixed; }
            .main-content { margin-left: var(--sidebar-width); }
            .menu-toggle { display: none; }
        }
        @media (max-width: 768px) {
            .settings-container { padding: 1rem; }
            .page-title { font-size: 1.25rem; }
            .user-profile span, .user-profile i { display: none; }
        }
    </style>
</head>
<body>
    <div class="sidebar-overlay" id="sidebarOverlay" onclick="toggleSidebar()"></div>
    <aside class="sidebar" id="sidebar" style="overflow-y: hidden;">
        <div class="sidebar-header">
            <div class="sidebar-logo">Kajwelo</div>
            <div class="sidebar-subtitle">Seller Portal</div>
        </div>
        <ul class="sidebar-menu">
            <li><button class="sidebar-link" onclick="gotodashboard()"><i class="fas fa-tachometer-alt"></i><span>Dashboard</span></button></li>
            <li><button class="sidebar-link" onclick="gotoproducts()"><i class="fas fa-box"></i><span>Products</span></button></li>
            <li><button class="sidebar-link" onclick="gotoOrders()"><i class="fas fa-shopping-bag"></i><span>Orders</span></button></li>
            <li><button class="sidebar-link" onclick="gotoanalytics()"><i class="fas fa-chart-line"></i><span>Analytics</span></button></li>
            <li><button class="sidebar-link" onclick="gotoCustomers()"><i class="fas fa-users"></i><span>Customers</span></button></li>
            <li><button class="sidebar-link" onclick="gotoInventory()"><i class="fas fa-warehouse"></i><span>Inventory</span></button></li>
            <li><button class="sidebar-link" onclick="gotoPending()"><i class="fa-solid fa-hourglass-start"></i><span>Pending</span></button></li>
            <li><button class="sidebar-link active" onclick="gotoSettings()"><i class="fas fa-cog"></i><span>Settings</span></button></li>
            <li><button class="sidebar-link" onclick="gotoInbox()"><i class="fa-solid fa-inbox"></i><span>Inbox</span></button></li>
        </ul>
        <div>
            <button class="sidebar-link" onclick="handleLogout()">
                <i class="fa-solid fa-right-from-bracket"></i>
                <span>LOG OUT</span>
            </button>
        </div>
    </aside>

    <main class="main-content">
        <header class="topbar">
            <div class="topbar-left">
                <button class="menu-toggle" onclick="toggleSidebar()"><i class="fas fa-bars"></i></button>
                <h1 class="page-title">Account Settings</h1>
            </div>
            <div class="topbar-right">
                <button class="notification-btn" style="background:none;border:none;position:relative;margin-right:1rem;">
                    <i class="fas fa-bell"></i>
                    <span class="notification-badge" style="position:absolute;top:-4px;right:-6px;background:#ef4444;color:#fff;border-radius:50%;width:18px;height:18px;display:flex;align-items:center;justify-content:center;font-size:0.7rem;">3</span>
                </button>
                <div class="user-profile">
                    <div class="user-avatar" id="userAvatar">S</div>
                    <span id="userNameTop">Seller</span>
                    <i class="fas fa-chevron-down"></i>
                </div>
            </div>
        </header>

        <div class="settings-container">

            <div class="card-like">
                <div class="section-title"><i class="fas fa-user"></i> Profile & Store</div>
                <div class="row g-3">
                    <div class="col-md-6">
                        <label class="form-label">Full Name</label>
                        <input type="text" id="nameInput" class="form-control" placeholder="Your name">
                    </div>
                    <div class="col-md-6">
                        <label class="form-label">Email</label>
                        <input type="email" id="emailInput" class="form-control" placeholder="your@email.com" disabled>
                    </div>
                    <div class="col-md-6">
                        <label class="form-label">Phone</label>
                        <input type="tel" id="phoneInput" class="form-control" placeholder="+1 555-555-5555">
                    </div>
                    <div class="col-md-6">
                        <label class="form-label">Brand Name</label>
                        <input type="text" id="brandInput" class="form-control" placeholder="Your brand">
                    </div>
                    <div class="col-md-6">
                        <label class="form-label">Business Address</label>
                        <input type="text" id="addressInput" class="form-control" placeholder="Address">
                    </div>
                    <div class="col-md-6">
                        <label class="form-label">Target Audience</label>
                        <input type="text" id="audienceInput" class="form-control" placeholder="e.g. Women 18-35">
                    </div>
                </div>
                <div class="d-flex gap-2 mt-3">
                    <button class="btn btn-primary" onclick="saveProfile()"><i class="fas fa-save"></i> Save Profile</button>
                </div>
            </div>

            <div class="card-like">
                <div class="section-title"><i class="fas fa-shield-alt"></i> Security</div>
                <div class="row g-3">
                    <div class="col-md-4">
                        <label class="form-label">Current Password</label>
                        <input type="password" id="currentPassword" class="form-control" placeholder="Current password">
                    </div>
                    <div class="col-md-4">
                        <label class="form-label">New Password</label>
                        <input type="password" id="newPassword" class="form-control" placeholder="New password">
                    </div>
                    <div class="col-md-4">
                        <label class="form-label">Confirm Password</label>
                        <input type="password" id="confirmPassword" class="form-control" placeholder="Confirm password">
                    </div>
                </div>
                <div class="d-flex gap-2 mt-3">
                    <button class="btn btn-primary" onclick="changePassword()"><i class="fas fa-lock"></i> Update Password</button>
                </div>
            </div>

            <div class="card-like">
                <div class="section-title"><i class="fas fa-bell"></i> Notifications</div>
                <div class="row g-3">
                    <div class="col-md-4">
                        <div class="form-check">
                            <input class="form-check-input" type="checkbox" id="notifOrders">
                            <label class="form-check-label" for="notifOrders">Order Updates</label>
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="form-check">
                            <input class="form-check-input" type="checkbox" id="notifInventory">
                            <label class="form-check-label" for="notifInventory">Inventory Alerts</label>
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="form-check">
                            <input class="form-check-input" type="checkbox" id="notifDigest">
                            <label class="form-check-label" for="notifDigest">Weekly Summary</label>
                        </div>
                    </div>
                </div>
                <div class="d-flex gap-2 mt-3">
                    <button class="btn btn-primary" onclick="saveNotifications()"><i class="fas fa-save"></i> Save Preferences</button>
                </div>
            </div>

            <div class="card-like">
                <div class="section-title" style="color:#dc2626"><i class="fas fa-exclamation-triangle"></i> Danger Zone</div>
                <div class="danger-box">
                    <div class="d-flex flex-column flex-sm-row align-items-start align-items-sm-center justify-content-between gap-2">
                        <div>
                            <div style="font-weight:600; color:var(--dark-color)">Delete Account</div>
                            <div style="color:#6b7280; font-size:0.9rem">Permanently delete your seller account and all associated data.</div>
                        </div>
                        <button class="btn btn-danger" onclick="deleteAccount()"><i class="fas fa-trash"></i> Delete Account</button>
                    </div>
                    <div class="divider"></div>
                    <div class="d-flex flex-column flex-sm-row align-items-start align-items-sm-center justify-content-between gap-2">
                        <div>
                            <div style="font-weight:600; color:var(--dark-color)">Log out</div>
                            <div style="color:#6b7280; font-size:0.9rem">Sign out of your seller dashboard.</div>
                        </div>
                        <button class="btn btn-outline" onclick="handleLogout()"><i class="fas fa-right-from-bracket"></i> Log Out</button>
                    </div>
                </div>
            </div>

        </div>
    </main>

    <div id="toast" class="notification info"></div>

    <script>
        function gotodashboard(){ window.location.href = "sellerdashboard.html"; }
        function gotoproducts(){ window.location.href = "SelleraAddProduct.html"; }
        function gotoOrders(){ window.location.href = "sellerOrders.html"; }
        function gotoanalytics(){ window.location.href = "SellerAnalytics.html"; }
        function gotoCustomers(){ window.location.href = "sellerCustomers.html"; }
        function gotoInventory(){ window.location.href = "SellerInventory.html"; }
        function gotoPending(){ window.location.href = "sellerPending.html"; }
        function gotoSettings(){ /* already here */ }
        function gotoInbox(){ window.location.href = "inbox.html"; }

        function toggleSidebar(){
            const sidebar = document.getElementById('sidebar');
            const overlay = document.getElementById('sidebarOverlay');
            sidebar.classList.toggle('open');
            overlay.classList.toggle('active');
        }

        function showToast(message, type = 'info'){
            const toast = document.getElementById('toast');
            toast.textContent = message;
            toast.className = `notification ${type} show`;
            setTimeout(() => { toast.className = `notification ${type}`; }, 2500);
        }

        function encodeUnicode(str){ return btoa(unescape(encodeURIComponent(str))); }
        function decodeUnicode(base64){ try { return decodeURIComponent(escape(atob(base64))); } catch(e){ return base64; } }

        function getCurrentUser(){
            const raw = localStorage.getItem('loggedInUser');
            return raw ? JSON.parse(raw) : null;
        }

        function setCurrentUser(user){ localStorage.setItem('loggedInUser', JSON.stringify(user)); }

        function getUsers(){
            const raw = localStorage.getItem('users');
            return raw ? JSON.parse(raw) : [];
        }

        function setUsers(users){ localStorage.setItem('users', JSON.stringify(users)); }

        function hydrateForm(){
            const user = getCurrentUser();
            if(!user){ showToast('No user logged in', 'error'); return; }
            document.getElementById('nameInput').value = user.name || '';
            document.getElementById('emailInput').value = user.email || '';
            document.getElementById('phoneInput').value = user.phone || '';
            document.getElementById('brandInput').value = user.brandName || '';
            document.getElementById('addressInput').value = user.businessAddress || '';
            document.getElementById('audienceInput').value = user.targetAudience || '';
            const initials = (user.name || 'S').split(' ').map(n => n[0]).join('').slice(0,2).toUpperCase();
            document.getElementById('userAvatar').textContent = initials;
            document.getElementById('userNameTop').textContent = user.name || 'Seller';

            const notifKey = `seller_notifications_${user.id || user.email}`;
            const prefs = JSON.parse(localStorage.getItem(notifKey) || '{}');
            document.getElementById('notifOrders').checked = !!prefs.orders;
            document.getElementById('notifInventory').checked = !!prefs.inventory;
            document.getElementById('notifDigest').checked = !!prefs.digest;
        }

        function saveProfile(){
            const user = getCurrentUser();
            if(!user){ showToast('No user session', 'error'); return; }
            const updated = { ...user };
            updated.name = document.getElementById('nameInput').value.trim();
            updated.phone = document.getElementById('phoneInput').value.trim();
            updated.brandName = document.getElementById('brandInput').value.trim();
            updated.businessAddress = document.getElementById('addressInput').value.trim();
            updated.targetAudience = document.getElementById('audienceInput').value.trim();

            const users = getUsers();
            const idx = users.findIndex(u => u.id === user.id || u.email === user.email);
            if(idx !== -1){ users[idx] = { ...users[idx], ...updated }; setUsers(users); }
            setCurrentUser(updated);
            showToast('Profile saved', 'success');
        }

        function changePassword(){
            const user = getCurrentUser();
            if(!user){ showToast('No user session', 'error'); return; }
            const current = document.getElementById('currentPassword').value;
            const next = document.getElementById('newPassword').value;
            const confirm = document.getElementById('confirmPassword').value;
            const decoded = decodeUnicode(user.password || '');
            if(!current || !next){ showToast('Fill password fields', 'error'); return; }
            if(next !== confirm){ showToast('Passwords do not match', 'error'); return; }
            if(decoded !== current){ showToast('Current password incorrect', 'error'); return; }
            const encoded = encodeUnicode(next);
            const updated = { ...user, password: encoded };
            const users = getUsers();
            const idx = users.findIndex(u => u.id === user.id || u.email === user.email);
            if(idx !== -1){ users[idx].password = encoded; setUsers(users); }
            setCurrentUser(updated);
            document.getElementById('currentPassword').value = '';
            document.getElementById('newPassword').value = '';
            document.getElementById('confirmPassword').value = '';
            showToast('Password updated', 'success');
        }

        function saveNotifications(){
            const user = getCurrentUser();
            if(!user){ showToast('No user session', 'error'); return; }
            const notifKey = `seller_notifications_${user.id || user.email}`;
            const prefs = {
                orders: document.getElementById('notifOrders').checked,
                inventory: document.getElementById('notifInventory').checked,
                digest: document.getElementById('notifDigest').checked,
                updatedAt: new Date().toISOString()
            };
            localStorage.setItem(notifKey, JSON.stringify(prefs));
            showToast('Notification preferences saved', 'success');
        }

        function handleLogout(){
            localStorage.removeItem('loggedInUser');
            window.location.href = "../login.html";
        }

        function deleteAccount(){
            if(!confirm('Are you sure you want to permanently delete your account?')) return;
            const user = getCurrentUser();
            if(!user){ showToast('No user session', 'error'); return; }
            const users = getUsers();
            const previousUsers = JSON.parse(localStorage.getItem('previousUsers') || '[]');
            const remaining = users.filter(u => (u.id || u.email) !== (user.id || user.email));
            previousUsers.push(user.email);
            localStorage.setItem('previousUsers', JSON.stringify(previousUsers));
            setUsers(remaining);
            localStorage.removeItem('loggedInUser');
            showToast('Account deleted', 'success');
            setTimeout(() => { window.location.href = "../login.html"; }, 800);
        }

        document.addEventListener('DOMContentLoaded', hydrateForm);
        window.addEventListener('resize', function(){ if(window.innerWidth >= 993){ document.getElementById('sidebar').classList.remove('open'); document.getElementById('sidebarOverlay').classList.remove('active'); } });
    </script>
</body>
</html>



